import 'package:flutter/material.dart';
import 'package:rxdart/rxdart.dart';
import 'package:time_tracker_flutter_course/app/home/entries/entry_job.dart';
import 'package:time_tracker_flutter_course/app/home/models/entry.dart';
import 'package:time_tracker_flutter_course/app/home/models/job.dart';
import 'package:time_tracker_flutter_course/services/database.dart';

class EntriesBloc {
  EntriesBloc(this.context, {@required this.database});
  final Database database;
  BuildContext context;

  /// combine List<Job>, List<Entry> into List<EntryJob>
  Stream<List<EntryJob>> get _allEntriesStream => Rx.combineLatest2(
        database.entriesStream(),
        database.jobsStream(),
        _entriesJobsCombiner,
      );

  static List<EntryJob> _entriesJobsCombiner(
      List<Entry> entries, List<Job> jobs) {
    return entries.map((entry) {
      final job = jobs.firstWhere(
        (job) => job.id == entry.jobId,
        orElse: () => null,
      );
      return EntryJob(entry, job);
    }).toList();
  }
}
